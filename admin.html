<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุชุญูู ูุฑูุดุฉ - ูุชุงุจุนุฉ ุงูุทูุจุงุช</title>
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (Sidebar) -->
    <div class="sidebar">
        <div class="admin-logo-section">
            <img src="5515928d-da81-433e-8bc9-245180ba6724.jpg" alt="Admin Logo" class="admin-logo">
            <p>ููุญุฉ ุงูุชุญูู</p>
        </div>
        
        <nav class="side-nav">
            <ul>
                <li class="active"><a href="#"><i class="fas fa-bell"></i> ุงูุทูุจุงุช ุงูุญูุฉ</a></li>
                <li><a href="#"><i class="fas fa-chart-line"></i> ุงูุณุฌู ูุงูุฅุญุตุงุฆูุงุช</a></li>
                <li><a href="#"><i class="fas fa-users"></i> ุดุงุช ุงููุฑูู</a></li>
                <li><a href="#"><i class="fas fa-box"></i> ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</a></li>
                <li><a href="#"><i class="fas fa-list"></i> ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</a></li>
                <li><a href="#"><i class="fas fa-file-alt"></i> ุงูุชูุงุฑูุฑ</a></li>
                <li><a href="#"><i class="fas fa-plus-circle"></i> ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</a></li>
                <li><a href="#"><i class="fas fa-user-tie"></i> ุงูููุธููู</a></li>
                <li class="badge-item">
                    <a href="#"><i class="fas fa-comments"></i> ุดุงุช ุงูุนููุงุก</a>
                    <span class="badge">5</span>
                </li>
            </ul>
        </nav>

        <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> ุฎุฑูุฌ</button>
    </div>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <div class="main-content">
        <header class="top-bar">
            <div class="server-status">
                <span class="dot"></span> ูุชุตู ุจุงูุฎุงุฏู
            </div>
            <div class="page-title" id="current-page-title">
                โก ุงูุทูุจุงุช ุงูุญูุฉ
            </div>
        </header>

        <!-- ูุณู ุงูุทูุจุงุช ุงูุญูุฉ (ุดุบุงู ุงูุชุฑุงุถูุงู) -->
        <section id="live-orders-section" class="admin-section active">
            <div class="orders-container">

                <!-- ุนููุฏ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ -->
                <div class="order-column">
                    <div class="column-header red-header">
                        <span><i class="fas fa-star"></i> ุทูุจุงุช ุฌุฏูุฏุฉ ุฑุงุฌุนูุง</span>
                    </div>

                    <div class="order-list" id="new-orders">
                        <!-- ูุงุฑุช ุทูุจ -->
                        <div class="order-card">
                            <div class="card-header">
                                <span class="order-id">#eJ5H</span>
                                <span class="order-time">07:42 ู</span>
                            </div>
                            <div class="customer-info">
                                <h4>ุดูุดูู</h4>
                                <p><i class="fas fa-map-marker-alt"></i> ุงููุนุงุฏู - ูุด</p>
                            </div>
                            <div class="card-footer">
                                <button class="details-btn">ุงูุชูุงุตูู</button>
                                <span class="price">30 ุฌ</span>
                            </div>
                        </div>

                        <div class="order-card">
                            <div class="card-header">
                                <span class="order-id">#OvsK</span>
                                <span class="order-time">02:21 ู</span>
                            </div>
                            <div class="customer-info">
                                <h4>ูุญููุฏ</h4>
                                <p><i class="fas fa-map-marker-alt"></i> ูุตุฑ ุงูุฌุฏูุฏุฉ - ุนูุงุฑุฉ 17Bุ ุดุงุฑุน ูุญูุฏ ุจุฏุฑ</p>
                            </div>
                            <div class="card-footer">
                                <button class="details-btn">ุงูุชูุงุตูู</button>
                                <span class="price">37 ุฌ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุนููุฏ ูู ุงููุทุจุฎ -->
                <div class="order-column">
                    <div class="column-header blue-header">
                        <span><i class="fas fa-fire"></i> ูู ุงููุทุจุฎ (ุฌุงุฑู)</span>
                    </div>

                    <div class="order-list" id="kitchen-orders">
                        <div class="order-card kitchen-card">
                            <div class="card-header">
                                <span class="order-id">#LKCu</span>
                                <span class="order-time">10:03 ุต</span>
                            </div>
                            <div class="customer-info">
                                <h4>ูุญููุฏ</h4>
                                <p><i class="fas fa-map-marker-alt"></i> ูุตุฑ ุงูุฌุฏูุฏุฉ - ุนูุงุฑุฉ 17Bุ ุดุงุฑุน ูุญูุฏ ุจุฏุฑ</p>
                            </div>
                            <div class="card-footer">
                                <button class="details-btn">ุงูุชูุงุตูู</button>
                                <span class="price">37 ุฌ</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ูุณู ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช -->
        <section id="manage-products-section" class="admin-section">
            <div class="table-container">
                <h3>ูุงุฆูุฉ ูุฌุจุงุช ูุทุนู ูุฑูุดุฉ</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ุงููุฌุจุฉ</th>
                            <th>ุงูุณุนุฑ (ุนุงุฏู)</th>
                            <th>ุงููุณู</th>
                            <th>ุงูุญุงูุฉ</th>
                            <th>ุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ุงูููุชุฌุงุช ุณุชูุญูู ุฏููุงููููุงู -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ูุณู ุฅุฏุงุฑุฉ ุฃูุณุงู ุงููููู ูู ุตูุญุฉ ุงูุฃุฏูู -->
        <section id="manage-categories-section" class="admin-section">
            <div class="table-container">
                <h3>ุฅุฏุงุฑุฉ ุฃูุณุงู ุงููููู (ุงููุงุฆูุฉ ุงูุนูููุฉ)</h3>
                <div class="admin-card">
                    <h3>ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ูููุงุฆูุฉ</h3>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="categoryInput" placeholder="ุงูุชุจ ุงุณู ุงููุณู (ูุซูุงู: ุนุฑูุถ ุงูุดุชุงุก)">
                        <button onclick="saveCategory()" class="btn-add">ุฅุถุงูุฉ ุงููุณู</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ุงุณู ุงููุณู</th>
                            <th>ุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody id="admin-categories-table">
                        <!-- ุงูุฃูุณุงู ูุชุธูุฑ ููุง ุจุฑูุฌูุงู -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ูุณู ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ -->
        <section id="add-product-section" class="admin-section">
            <div class="form-container">
                <h3>ุฅุถุงูุฉ ูุฌุจุฉ ุฌุฏูุฏุฉ ูููููู</h3>
                <form id="add-food-form">
                    <input type="text" id="food-name" placeholder="ุงุณู ุงููุฌุจุฉ" required>
                    <div class="prices-section">
                        <label>ุงูุฃุญุฌุงู ูุงูุฃุณุนุงุฑ:</label>
                        <div id="prices-container">
                            <!-- ุฃูู ุตู ููููู ููุฌูุฏ ุฏุงููุงู -->
                            <div class="price-row">
                                <input type="text" placeholder="ุงูุญุฌู (ูุซูุงู: ูุณุท)" class="size-input">
                                <input type="number" placeholder="ุงูุณุนุฑ" class="price-input">
                            </div>
                        </div>
                        <button type="button" onclick="addPriceRow()" class="btn-add-size">+ ุฅุถุงูุฉ ุญุฌู ุขุฎุฑ</button>
                    </div>
                    <input type="file" id="food-img-file" accept="image/*">
                    <textarea id="food-desc" placeholder="ูุตู ุงููุฌุจุฉ"></textarea>
                    <select id="categorySelect" required>
                        <option value="">ุงุฎุชุฑ ุงููุณู</option>
                    </select>
                    <button type="submit" class="btn-main-red">ุญูุธ ุงูููุชุฌ</button>
                </form>
            </div>
        </section>

        <!-- ูุณู ุณุฌู ุงูุทูุจุงุช -->
        <section id="records-section" class="admin-section">
            <div class="table-container" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>๐ ุณุฌู ุงููุจูุนุงุช ูุงูุทูุจุงุช</h3>
                    <div class="filter-box">
                        <input type="text" id="searchOrders" placeholder="ุจุญุซ ุจุงุณู ุงูุนููู ุฃู ุงูุฑูู..." onkeyup="filterRecords()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </div>

                <table style="width: 100%; border-collapse: collapse; text-align: right;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #eee;">
                            <th style="padding: 15px;">ุฑูู ุงูุทูุจ</th>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงูุนููู</th>
                            <th>ุงููุฌุจุงุช</th>
                            <th>ุงูุฅุฌูุงูู</th>
                            <th>ุงูุญุงูุฉ</th>
                        </tr>
                    </thead>
                    <tbody id="records-table-body">
                        <!-- ุงูุจูุงูุงุช ูุชุธูุฑ ููุง ุจุงูู JS -->
                    </tbody>
                </table>

                <div style="margin-top: 20px; padding: 15px; background: #e31e24; color: white; border-radius: 10px; display: inline-block;">
                    ุฅุฌูุงูู ูุจูุนุงุช ุงูุณุฌู: <span id="total-sales-amount" style="font-weight: bold; font-size: 20px;">0</span> ุฌ.ู
                </div>
            </div>
        </section>
    </div>

    <!-- ุชุญููู ููุชุจุงุช ูุงูุฑุจูุฒ ุงูุฃุณุงุณูุฉ -->
    <script type="module">
      // ุงุณุชูุฑุงุฏ ุงูุฏูุงู ุงููู ูุญุชุงุฌูููุง
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

      // ุจูุงูุงุช ูุดุฑูุนู
      const firebaseConfig = {
        apiKey: "AIzaSyArc3Y--aq-6e8omAbcpm8fZ5BvNcYMtkw",
        authDomain: "karmasha-bfad3.firebaseapp.com",
        projectId: "karmasha-bfad3",
        storageBucket: "karmasha-bfad3.firebasestorage.app",
        messagingSenderId: "584846393500",
        appId: "1:584846393500:web:5a58f969f3a66126026d59",
        measurementId: "G-G518D7LXSS"
      };

      // ุชุดุบูู ูุงูุฑุจูุฒ
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // ุชุตุฏูุฑ ุงูุฃุฏูุงุช ุนุดุงู ูุณุชุฎุฏููุง ูู ุจุงูู ุงูููุฏ
      window.db = db;

      function listenToOrders() {
          const q = query(collection(window.db, "orders"), orderBy("createdAt", "desc"));

          onSnapshot(q, (snapshot) => {
              const newOrdersContainer = document.getElementById('new-orders'); // ุงูุนููุฏ ุงูุฃุญูุฑ
              const kitchenOrdersContainer = document.getElementById('kitchen-orders'); // ุนููุฏ ุงููุทุจุฎ

              newOrdersContainer.innerHTML = '';
              kitchenOrdersContainer.innerHTML = '';

              snapshot.forEach((docSnapshot) => {
                  const order = docSnapshot.data();
                  const orderId = docSnapshot.id;

                  // ูุงุฑุช ุงูุทูุจ ุจุชูุณูู ูุฑูุดุฉ
                  const orderHtml = `
                      <div class="order-card">
                          <div class="card-header">
                              <span class="order-id">#${orderId.substring(0,5)}</span>
                              <span class="order-time">${order.createdAt?.toDate().toLocaleTimeString('ar-EG') || 'ุงูุขู'}</span>
                          </div>
                          <div class="customer-info">
                              <h4>${order.customerName}</h4>
                              <p><i class="fas fa-map-marker-alt"></i> ${order.customerAddress}</p>
                              <p><i class="fas fa-phone"></i> ${order.customerPhone}</p>
                              <div style="font-size:12px; color:#d2000a; margin-top:5px;">
                                  ${order.items.map(i => `โข ${i.name}`).join('<br>')}
                              </div>
                          </div>
                          <div class="card-footer">
                              ${order.status === "ุฌุฏูุฏ"
                                  ? `<button class="details-btn" onclick="moveToKitchen('${orderId}')">ูุจูู ุงูุทูุจ</button>`
                                  : `<button class="details-btn" style="background:#2e7d32; color:white;">ุจุฏุฃ ุงูุทูู</button>`}
                              <span class="price">${order.totalPrice} ุฌ</span>
                          </div>
                      </div>
                  `;

                  if (order.status === "ุฌุฏูุฏ") {
                      newOrdersContainer.innerHTML += orderHtml;
                  } else if (order.status === "ูู ุงููุทุจุฎ") {
                      kitchenOrdersContainer.innerHTML += orderHtml;
                  }
              });
          });
      }

      // ุฏุงูุฉ ูููู ุงูุทูุจ ูู "ุฌุฏูุฏ" ุฅูู "ูู ุงููุทุจุฎ"
      window.moveToKitchen = async function(id) {
          const orderRef = doc(window.db, "orders", id);
          await updateDoc(orderRef, { status: "ูู ุงููุทุจุฎ" });
      };

      // ุฏุงูุฉ ุฑูุน ุงูุตูุฑุฉ ูููุงูุฑุจูุฒ ุณุชูุฑูุฌ
      async function uploadImage(file) {
          const storage = getStorage();
          const storageRef = ref(storage, 'products/' + file.name);
          await uploadBytes(storageRef, file);
          const url = await getDownloadURL(storageRef);
          return url; // ูุฐุง ุงููููู ูู ูุง ุณูุญูุธู ูู Firestore
      }

      listenToOrders();
    </script>

<script>
    // ุงูุญุตูู ุนูู ุฌููุน ุฃุฒุฑุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
    const menuItems = document.querySelectorAll('.side-nav li');

    // ุงูุญุตูู ุนูู ุฌููุน ุฃูุณุงู ุงููุญุชูู
    const sections = document.querySelectorAll('.admin-section');

    // ุนููุงู ุงูุตูุญุฉ ูู ุงูููุฏุฑ
    const pageTitle = document.getElementById('current-page-title');

    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            // 1. ุฅุฒุงูุฉ ุญุงูุฉ ุงููุดุงุท (active) ูู ูู ุงูุฃุฒุฑุงุฑ
            menuItems.forEach(i => i.classList.remove('active'));

            // 2. ุฅุถุงูุฉ ุญุงูุฉ ุงููุดุงุท ููุฒุฑ ุงูุฐู ุชู ุงูุถุบุท ุนููู
            this.classList.add('active');

            // 3. ุฅุฎูุงุก ูู ุงูุฃูุณุงู
            sections.forEach(sec => sec.classList.remove('active'));

            // 4. ุชุญุฏูุฏ ุฃู ูุณู ุณูุธูุฑ ุจูุงุกู ุนูู ุงููุต ุฏุงุฎู ุงูุฒุฑ
            const text = this.innerText.trim();

            if (text.includes("ุงูุทูุจุงุช ุงูุญูุฉ")) {
                document.getElementById('live-orders-section').classList.add('active');
                pageTitle.innerText = "โก ุงูุทูุจุงุช ุงูุญูุฉ";
            }
            else if (text.includes("ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช")) {
                document.getElementById('manage-products-section').classList.add('active');
                pageTitle.innerText = "๐ฆ ุฅุฏุงุฑุฉ ุงููููู";
                updateProductsTable();
            }
            else if (text.includes("ุฅุฏุงุฑุฉ ุงูุฃูุณุงู")) {
                document.getElementById('manage-categories-section').classList.add('active');
                pageTitle.innerText = "๐ ุฅุฏุงุฑุฉ ุงูุฃูุณุงู";
                displayCategoriesInAdmin();
            }
            else if (text.includes("ุงูุณุฌู ูุงูุฅุญุตุงุฆูุงุช")) {
                document.getElementById('records-section').classList.add('active');
                pageTitle.innerText = "๐ ุณุฌู ุงูุนูููุงุช";
                loadOrderRecords();
            }
            else if (text.includes("ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ")) {
                document.getElementById('add-product-section').classList.add('active');
                pageTitle.innerText = "โ ุฅุถุงูุฉ ูุฌุจุฉ ุฌุฏูุฏุฉ";
            }
            // ููููู ุฅุถุงูุฉ ุจุงูู ุงูุดุฑูุท ููุง ููุชูุงุฑูุฑ ูุงูููุธููู...
        });
    });

    // Product management
    let editingIndex = null;
    let productBase64Image = "";

    // ูุฑุงูุจุฉ ุงุฎุชูุงุฑ ุงูุตูุฑุฉ ูุชุญููููุง
    document.getElementById('food-img-file').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => productBase64Image = reader.result;
        reader.readAsDataURL(e.target.files[0]);
    });

    // ุฏุงูุฉ ูุฅุถุงูุฉ ุตู ุฌุฏูุฏ ุชุญุช ุจุนุถู
    function addPriceRow() {
        const container = document.getElementById('prices-container');
        const newRow = document.createElement('div');
        newRow.className = 'price-row';
        newRow.innerHTML = `
            <input type="text" placeholder="ุงูุญุฌู" class="size-input">
            <input type="number" placeholder="ุงูุณุนุฑ" class="price-input">
            <button type="button" onclick="this.parentElement.remove()" class="btn-remove">ร</button>
        `;
        container.appendChild(newRow);
    }

    // ุฏุงูุฉ ุญูุธ ุงูููุชุฌ
    async function saveProduct() {
        const name = document.querySelector('input[placeholder="ุงุณู ุงููุฌุจุฉ"]').value;
        const desc = document.querySelector('textarea[placeholder="ูุตู ุงููุฌุจุฉ"]').value;
        const category = document.querySelector('select').value;

        // --- ุงูุณุญุฑ ููุง: ุชุฌููุน ุงูุจูุงูุงุช ูู ุงูุตููู ---
        const rows = document.querySelectorAll('.price-row');
        let pricesArray = [];

        rows.forEach(row => {
            const size = row.querySelector('.size-input').value;
            const price = row.querySelector('.price-input').value;
            if (size && price) {
                pricesArray.push({ size: size, price: parseInt(price) });
            }
        });

        if (pricesArray.length === 0) {
            alert("ูุงุฒู ุชุถูู ุญุฌู ูุณุนุฑ ูุงุญุฏ ุนูู ุงูุฃูู!");
            return;
        }

        const newProduct = {
            name: name,
            description: desc,
            category: category,
            img: productBase64Image || 'default.jpg',
            prices: pricesArray
        };

        // ุญูุธ ูู LocalStorage
        let products = JSON.parse(localStorage.getItem('products')) || [];
        products.push(newProduct);
        localStorage.setItem('products', JSON.stringify(products));

        alert("ุชู ุญูุธ ุงูููุชุฌ ุจูุฌุงุญ! ๐ฅ");
        location.reload();
    }

    // ุฑุจุท ุฒุฑุงุฑ ุงูุญูุธ ุจุงูุฏุงูุฉ
    document.getElementById('add-food-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveProduct();
    });

    function updateProductsTable() {
        const tbody = document.querySelector('#manage-products-section tbody');
        tbody.innerHTML = '';
        let products = JSON.parse(localStorage.getItem('products')) || [];
        products.forEach((product, index) => {
            const row = `<tr>
                <td>${product.name}</td>
                <td>${product.price} ุฌ</td>
                <td>${product.category || 'ุบูุฑ ูุญุฏุฏ'}</td>
                <td><span class="status success">ูุชููุฑ</span></td>
                <td>
                    <button class="btn-edit" onclick="editProduct(${index})">ุชุนุฏูู</button>
                    <button class="btn-edit" style="background: #f44336; margin-left: 5px;" onclick="deleteProduct(${index})">ุญุฐู</button>
                </td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function editProduct(index) {
        let products = JSON.parse(localStorage.getItem('products')) || [];
        const product = products[index];
        form.querySelector('input[type="text"]').value = product.name;
        form.querySelector('input[type="number"]').value = product.price;
        form.querySelector('textarea').value = product.description;
        form.querySelector('#categorySelect').value = product.category || '';
        editingIndex = index;
        submitBtn.textContent = 'ุชุญุฏูุซ ุงูููุชุฌ';
        // Switch to add section
        sections.forEach(sec => sec.classList.remove('active'));
        document.getElementById('add-product-section').classList.add('active');
        pageTitle.innerText = "โ๏ธ ุชุนุฏูู ุงูููุชุฌ";
    }

    function deleteProduct(index) {
        if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูููุชุฌุ')) {
            let products = JSON.parse(localStorage.getItem('products')) || [];
            products.splice(index, 1);
            localStorage.setItem('products', JSON.stringify(products));
            updateProductsTable();
            alert('ุชู ุญุฐู ุงูููุชุฌ!');
        }
    }

    // 1. ูุตูููุฉ ุงูุฃูุณุงู ุงูุงูุชุฑุงุถูุฉ
    let categories = JSON.parse(localStorage.getItem('karmashaCategories')) ||
                     ["ูุฑุงูุฏ ุชุดููู", "ุชุดููู ุณุชุฑุจุณ"];

    // 2. ูุธููุฉ ูุนุฑุถ ุงูุฃูุณุงู ูู ุฌุฏูู ุงูุฃุฏูู
    function displayCategoriesInAdmin() {
        const tableBody = document.getElementById('admin-categories-table');
        if (!tableBody) return; // ุชุฃูุฏ ุฅู ุงูุฌุฏูู ููุฌูุฏ

        tableBody.innerHTML = '';

        // ุฌูุจ ุงูุฃูุณุงู ูู ุงูููุชุงุญ ุงูููุญุฏ ุงููู ุจูุณุชุฎุฏูู ุนูุฏ ุงููุดุชุฑู
        let savedCategories = JSON.parse(localStorage.getItem('karmashaCategories')) || ["ูุฑุงูุฏ ุชุดููู", "ุชุดููู ุณุชุฑุจุณ"];

        savedCategories.forEach((cat, index) => {
            tableBody.innerHTML += `
                <tr>
                    <td>${cat}</td>
                    <td>
                        <button onclick="deleteCategory(${index})" class="btn-edit" style="background: #f44336;">ุญุฐู</button>
                    </td>
                </tr>
            `;
        });
    }

    function saveCategory() {
        let catInput = document.getElementById('categoryInput');
        let catName = catInput.value.trim();

        if (catName === "") {
            alert("ุงูุชุจ ุงุณู ุงููุณู ุงูุฃูู!");
            return;
        }

        let savedCategories = JSON.parse(localStorage.getItem('karmashaCategories')) || ["ูุฑุงูุฏ ุชุดููู", "ุชุดููู ุณุชุฑุจุณ"];
        savedCategories.push(catName);
        
        // ุญูุธ ูู ุงูููุชุงุญ ุงูููุญุฏ
        localStorage.setItem('karmashaCategories', JSON.stringify(savedCategories));

        alert("ุงููุณู ุงูุถุงู ุจูุฌุงุญ!");
        catInput.value = ""; 
        
        // ุฃูู ุฎุทูุฉ: ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุนุฑุถ ูุชุญุฏูุซ ุงูุฌุฏูู ุฃูุงูู ููุฑุงู
        displayCategoriesInAdmin(); 
        populateCategorySelect(); // ูุชุญุฏูุซ ุงููุงุฆูุฉ ูู "ุฅุถุงูุฉ ููุชุฌ"
    }

    // 4. ูุธููุฉ ุญุฐู ูุณู
    function deleteCategory(index) {
        if(confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุณูุ")) {
            let categoriesList = JSON.parse(localStorage.getItem('karmashaCategories')) || [];
            categoriesList.splice(index, 1);
            localStorage.setItem('karmashaCategories', JSON.stringify(categoriesList));
            displayCategoriesInAdmin(); // ุชุญุฏูุซ ุงูุฌุฏูู ููุฑุงู
        }
    }

    // ูุธููุฉ ูุชุนุจุฆุฉ ูุงุฆูุฉ ุงูุฃูุณุงู ูู ูููุฐุฌ ุฅุถุงูุฉ ุงูููุชุฌ
    function populateCategorySelect() {
        const select = document.getElementById('categorySelect');
        select.innerHTML = '<option value="">ุงุฎุชุฑ ุงููุณู</option>';
        categories.forEach(cat => {
            select.innerHTML += `<option value="${cat}">${cat}</option>`;
        });
    }

    // ูุซุงู ูุฅุถุงูุฉ ูุณู ูู ูุงูุฑุจูุฒ (ุฏุงุฎู ุณูุฑูุจุช ุงูููุฏููู ูู ุงูุฃุฏูู)
    window.saveCategoryToFirebase = async function() {
        const name = document.getElementById('categoryInput').value;
        try {
            await addDoc(collection(window.db, "categories"), {
                name: name,
                createdAt: new Date()
            });
            alert("ุชูุช ุงูุฅุถุงูุฉ ูููุงูุฑุจูุฒ ุจูุฌุงุญ!");
        } catch (e) { console.error(e); }
    }

    // ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุณุฌู (ุงูููุฑูุถ ุฏู ุชูุฌู ูู ุงูุฐุงูุฑุฉ)
    let orderRecords = [
        { id: "#1001", date: "2023-10-25 09:30 ู", customer: "ูุญูุฏ ุนูู", items: "ูุฌุจุฉ 3 ูุทุนุ ุณุชุฑุจุณ", total: 320, status: "ุชู ุงูุชูุตูู" },
        { id: "#1002", date: "2023-10-25 10:15 ู", customer: "ุฃุญูุฏ ุญุณู", items: "ุณูุฏูุชุด ุชูุฑุชููุง", total: 95, status: "ุชู ุงูุชูุตูู" },
        { id: "#1003", date: "2023-10-26 01:00 ุต", customer: "ุณุงุฑุฉ ูุญููุฏ", items: "ูุฌุจุฉ ุนุงุฆููุฉ 12 ูุทุนุฉ", total: 810, status: "ููุบู" }
    ];

    function loadOrderRecords() {
        const tableBody = document.getElementById('records-table-body');
        const totalSalesSpan = document.getElementById('total-sales-amount');

        tableBody.innerHTML = "";
        let totalSales = 0;

        orderRecords.forEach(order => {
            // ุญุณุงุจ ุงูุฅุฌูุงูู ููุทูุจุงุช ุงููู "ุชู ุงูุชูุตูู" ููุท
            if(order.status === "ุชู ุงูุชูุตูู") totalSales += order.total;

            let statusColor = order.status === "ุชู ุงูุชูุตูู" ? "#2e7d32" : "#c62828";

            tableBody.innerHTML += `
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px; font-weight: bold; color: #555;">${order.id}</td>
                    <td style="font-size: 13px; color: #888;">${order.date}</td>
                    <td>${order.customer}</td>
                    <td style="font-size: 13px;">${order.items}</td>
                    <td style="font-weight: bold;">${order.total} ุฌ</td>
                    <td><span style="color: white; background: ${statusColor}; padding: 4px 10px; border-radius: 20px; font-size: 12px;">${order.status}</span></td>
                </tr>
            `;
        });

        totalSalesSpan.innerText = totalSales;
    }

    // ุฏุงูุฉ ุงูุจุญุซ ูู ุงูุณุฌู
    function filterRecords() {
        let input = document.getElementById("searchOrders").value.toLowerCase();
        let rows = document.querySelectorAll("#records-table-body tr");

        rows.forEach(row => {
            let text = row.innerText.toLowerCase();
            row.style.display = text.includes(input) ? "" : "none";
        });
    }

    // ุชุดุบูู ุงูุนุฑุถ ุนูุฏ ูุชุญ ุงูุตูุญุฉ
    displayCategoriesInAdmin();
    populateCategorySelect();
</script>

</body>
</html>
