<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karmasha - Ù‚Ø±Ù…Ø´Ø© | Ø¹Ø§Ù„Ù… Ø§Ù„ÙØ±Ø§ÙŠØ¯ ØªØ´ÙŠÙƒÙ†</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Ø¥Ø¶Ø§ÙØ© Ø®Ø· ÙƒØ§ÙŠØ±Ùˆ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Loading Screen (Ø®Ø¯Ø¹Ø© Ø¨ØµØ±ÙŠØ© Ù„Ø£ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©) -->
    <div id="loader" class="loader-wrapper">
        <div class="loader-content">
            <img src="5515928d-da81-433e-8bc9-245180ba6724.jpg" class="loading-logo">
            <div class="progress-bar"></div>
        </div>
    </div>

    <header class="main-header">
        <div class="container logo-container">
            <img src="5515928d-da81-433e-8bc9-245180ba6724.jpg" alt="Karmasha Logo" class="site-logo floating">
        </div>
    </header>

    <nav class="top-nav">
        <div class="container">
            <ul>
                <li><a href="#" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#menu" class="nav-link">Ø§Ù„Ù…Ù†ÙŠÙˆ</a></li>
                <li><a href="#" class="nav-link">Ø§Ù„ÙØ±ÙˆØ¹</a></li>
            </ul>
            <div class="hotline pulse">
                <i class="fas fa-phone-alt"></i> 19218
            </div>
            <div id="user-area">
                <button onclick="openAuthModal()" class="login-btn-nav shine-btn">
                    <i class="fas fa-user-circle"></i> Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„
                </button>
            </div>
        </div>
    </nav>

    <section class="hero paralllax">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="text-glow">KARMASHA</h1>
           
        </div>
    </section>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <nav class="buyer-nav sticky-nav">
        <div class="nav-container" id="dynamicCategories"></div>
    </nav>

    <div id="productsContainer" class="container"></div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (ØªØ£Ø«ÙŠØ± Glassmorphism) -->
    <div id="auth-modal" class="modal blur-bg">
        <div class="modal-flex-container animate-pop">
            <!-- Ø§Ù„Ù†Øµ Ø§Ù„Ø´Ù…Ø§Ù„: Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØµÙˆØ±Ø© Ø¬Ø°Ø§Ø¨Ø© -->
            <div class="modal-image-side">
                 <img src="5515928d-da81-433e-8bc9-245180ba6724.jpg" class="side-logo-img">
                 <div class="side-text">
                     <h2>KARMASHA</h2>
                     <p>Ø£Ù‚ÙˆÙ‰ Ù‚Ø±Ù…Ø´Ø© ÙÙŠ Ù…ØµØ±</p>
                 </div>
            </div>

            <!-- Ø§Ù„Ù†Øµ Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„ÙÙˆØ±Ù… -->
            <div class="modal-form-side">
                <span class="close-modal" onclick="closeAuthModal()">&times;</span>
                <div id="login-form">
                    <h3 class="modal-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                    <div class="input-group">
                        <i class="fas fa-mobile-alt"></i>
                        <input type="tel" id="login-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    </div>
                    <button onclick="login()" class="btn-auth shine-btn">Ø¯Ø®ÙˆÙ„</button>
                    <p class="switch-text">Ù…Ø¹Ù†Ø¯ÙƒØ´ Ø­Ø³Ø§Ø¨ØŸ <a href="javascript:void(0)" onclick="toggleAuth('reg')">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a></p>
                </div>

                <div id="register-form" style="display:none;">
                    <h3 class="modal-title">Ø¹Ø¶ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ—</h3>
                    <div class="input-group"><i class="fas fa-user"></i><input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù…"></div>
                    <div class="input-group"><i class="fas fa-mobile-alt"></i><input type="tel" id="reg-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"></div>
                    <div class="input-group"><i class="fas fa-key"></i><input type="password" id="reg-pass" placeholder="Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù‚ÙˆÙŠ"></div>
                    <button onclick="register()" class="btn-auth">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                    <p class="switch-text">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ <a href="javascript:void(0)" onclick="toggleAuth('login')">Ø¯Ø®ÙˆÙ„</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div id="product-modal" class="modal blur-bg">
        <div class="product-details-container animate-pop">
            <span class="close-modal" onclick="closeModal()">&times;</span>

            <div class="product-flex">
                <!-- Ø¬Ø§Ù†Ø¨ Ø§Ù„ØµÙˆØ±Ø© -->
                <div class="product-main-img">
                    <img id="modal-img" src="" alt="">
                </div>

                <!-- Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
                <div class="product-main-info">
                    <h2 id="modal-name">Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©</h2>
                    <p id="modal-desc" class="product-description">ÙˆØµÙ Ø§Ù„ÙˆØ¬Ø¨Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ù‡Ù†Ø§...</p>

                    <div id="price-options-container" class="price-options">
                        <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù‡ØªÙ†Ø²Ù„ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ù€ JS -->
                    </div>

                    <div class="modal-actions">
                        <button id="modal-add-btn" class="add-to-cart-btn-large">
                            Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© <span id="modal-price-display">0</span> Ø¬.Ù…
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ -->
    <div id="profile-modal" class="modal blur-bg">
        <div class="modal-content glass-card animate-pop">
            <span class="close" onclick="toggleProfileModal()">&times;</span>
            <div class="profile-header">
                <div class="user-avatar-big">
                    <i class="fas fa-user-check"></i>
                </div>
                <h3 id="profile-name-title">Ù…Ø­Ù…ÙˆØ¯</h3>
                <p id="profile-phone-detail">01122884885</p>
            </div>
            
            <div class="profile-body">
                <h4><i class="fas fa-history"></i> Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h4>
                <div id="user-orders-list" class="user-orders-mini-list">
                    <p class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§ØªÙƒ...</p>
                </div>
            </div>
            
            <button onclick="logout()" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>

    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© -->
    <div class="cart-toggle ripple" onclick="toggleCart()">
        <i class="fas fa-shopping-basket"></i>
        <span id="cart-count">0</span>
    </div>

    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ² Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <script type="module">
      // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù„ÙŠ Ù…Ø­ØªØ§Ø¬ÙŠÙ†Ù‡Ø§
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, query, where, orderBy, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø¨Ø¹ØªÙ‡Ø§)
      const firebaseConfig = {
        apiKey: "AIzaSyArc3Y--aq-6e8omAbcpm8fZ5BvNcYMtkw",
        authDomain: "karmasha-bfad3.firebaseapp.com",
        projectId: "karmasha-bfad3",
        storageBucket: "karmasha-bfad3.firebasestorage.app",
        messagingSenderId: "584846393500",
        appId: "1:584846393500:web:5a58f969f3a66126026d59",
        measurementId: "G-G518D7LXSS"
      };

      // ØªØ´ØºÙŠÙ„ ÙØ§ÙŠØ±Ø¨ÙŠØ²
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø¹Ø´Ø§Ù† Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯
      window.db = db;
      window.auth = auth;
      window.initializeApp = initializeApp;
      window.getFirestore = getFirestore;
      window.collection = collection;
      window.addDoc = addDoc;
      window.getDocs = getDocs;
      window.onSnapshot = onSnapshot;
      window.doc = doc;
      window.updateDoc = updateDoc;
      window.deleteDoc = deleteDoc;
      window.serverTimestamp = serverTimestamp;
      window.query = query;
      window.where = where;
      window.orderBy = orderBy;
      window.setDoc = setDoc;
      window.getAuth = getAuth;
      window.signInWithEmailAndPassword = signInWithEmailAndPassword;
      window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
      window.onAuthStateChanged = onAuthStateChanged;
      window.signOut = signOut;
    </script>

    <!-- Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª (Ù†ÙØ³ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ø±ÙƒØ©) -->
    <script>
        // Ø®Ø¯Ø¹Ø© Ø§Ù„Ù€ Loader
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
            }, 1000);
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¹ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        function openAuthModal() { 
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
        }
        function closeAuthModal() { 
            document.getElementById('auth-modal').style.display = 'none'; 
        }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø¯Ø®ÙˆÙ„ ÙˆØªØ³Ø¬ÙŠÙ„
        function toggleAuth(type) {
            if (type === 'reg') {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            } else {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ùˆ Ø¶ØºØ·Øª ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¨Ø±Ù‡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø¨ÙŠØ¶
        window.onclick = function(event) {
            let modal = document.getElementById('auth-modal');
            if (event.target == modal) {
                closeAuthModal();
            }
        }

        // Initialize default products if none exist
        if (!localStorage.getItem('products')) {
            const defaultProducts = [
                { name: 'ÙˆØ¬Ø¨Ø© ØªØ´ÙŠÙƒÙ† ØµØºÙŠØ± (3 Ù‚Ø·Ø¹)', price: '140', description: '3 Ù‚Ø·Ø¹ ÙØ±Ø§ÙŠØ¯ ØªØ´ÙŠÙƒÙ† + Ø¹ÙŠØ´ + ÙƒÙˆÙ„ Ø³Ù„Ùˆ + Ø¨Ø·Ø§Ø·Ø³', category: 'ÙØ±Ø§ÙŠØ¯ ØªØ´ÙŠÙƒÙ†' },
                { name: 'ÙˆØ¬Ø¨Ø© Ù…Ø³Ø­Ø¨ Ø¹Ø§Ø¯ÙŠ', price: '175', description: '7 Ù‚Ø·Ø¹ Ù…Ø³Ø­Ø¨ + Ø¨Ø·Ø§Ø·Ø³ + ÙƒÙˆÙ„ Ø³Ù„Ùˆ', category: 'ÙˆØ¬Ø¨Ø§Øª Ù…Ø³Ø­Ø¨' },
                { name: 'ÙˆØ¬Ø¨Ø© Ø³ØªØ±Ø¨Ø³ ÙˆØ³Ø·', price: '150', description: '5 Ù‚Ø·Ø¹ Ø³ØªØ±Ø¨Ø³ + Ø¹ÙŠØ´ + Ø¨Ø·Ø§Ø·Ø³', category: 'ØªØ´ÙŠÙƒÙ† Ø³ØªØ±Ø¨Ø³' }
            ];
            localStorage.setItem('products', JSON.stringify(defaultProducts));
        }

        // Setup logger
        function setup_logger() {
            return {
                info: function(message) {
                    console.log('[INFO]', message);
                }
            };
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
        function selectCategory(element, catName) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ù„Ù„Ø²Ø± Ø§Ù„Ø°ÙŠ Ø¶ØºØ·Øª Ø¹Ù„ÙŠÙ‡
            element.classList.add('active');
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            renderProductsForCategory(catName);
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function renderProductsForCategory(c) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            // Ø¥ØµÙ„Ø§Ø­ 1: Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§ØªØ­Ù…Ù„Øª Ø£ØµÙ„Ø§Ù‹
            if(!window.allProducts) {
                container.innerHTML = '<div style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>';
                return;
            }

            const fil = window.allProducts.filter(p => p.category == c);

            if(!fil.length) {
                container.innerHTML='<p style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }

            const grid = document.createElement('div');
            grid.className='products-grid';

            fil.forEach(p => {
                // Ø¥ØµÙ„Ø§Ø­ 2 (Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©): Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù‡ Ø³Ø¹Ø± ÙˆØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶
                const price = (p.prices && p.prices.length > 0) ? p.prices[0].price : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const imgSrc = p.img ? p.img : 'https://via.placeholder.com/150';

                const pStr = encodeURIComponent(JSON.stringify(p));

                grid.innerHTML+=`
                <div class="food-card" onclick="openModal('${pStr}')">
                    <div class="food-image">
                        <img src="${imgSrc}" onerror="this.src='https://via.placeholder.com/150'">
                    </div>
                    <div class="food-details">
                        <h3>${p.name}</h3>
                        <span class="price-tag">${price} Ø¬</span>
                        <button class="view-btn">Ø§Ø·Ù„Ø¨</button>
                    </div>
                </div>`;
            });
            container.appendChild(grid);
        }

        // Open product modal
        function openModal(pStr) {
            const product = JSON.parse(decodeURIComponent(pStr));

            if (product) {
                document.getElementById('modal-name').innerText = product.name;
                document.getElementById('modal-desc').innerText = product.description;
                document.getElementById('modal-img').src = product.img;

                const optionsDiv = document.getElementById('price-options-container');
                optionsDiv.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¹Ø´Ø§Ù† Ù…ÙŠØ¸Ù‡Ø±Ø´ Ù…ÙƒØ±Ø±

                // Ù‡Ù†Ø§ Ø§Ù„Ø³Ø±: Ø¨Ù†Ù„Ù Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø¶ÙØªÙ‡Ø§ ÙÙŠ Ø§Ù„Ø£Ø¯Ù…Ù†
                product.prices.forEach((item, index) => {
                    optionsDiv.innerHTML += `
                        <label class="size-option" style="display: block; margin-bottom: 10px; border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer;">
                            <input type="radio" name="meal-size" value="${item.price}"
                                   data-size="${item.size}" ${index === 0 ? 'checked' : ''}
                                   onchange="updateModalPrice(this.value)" style="margin-left: 10px;">
                            <span>${item.size} (${item.price} Ø¬.Ù…)</span>
                        </label>
                    `;
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø²Ø±Ø§Ø±
                updateModalPrice(product.prices[0].price);

                // Ø¨Ø±Ù…Ø¬Ø© Ø²Ø±Ø§Ø± "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©"
                document.getElementById('modal-add-btn').onclick = () => {
                    const selected = document.querySelector('input[name="meal-size"]:checked');
                    const finalName = `${product.name} - Ø§Ù„Ø­Ø¬Ù…: ${selected.getAttribute('data-size')}`;
                    addToCart(finalName, parseInt(selected.value));
                    closeModal();
                };

                document.getElementById('product-modal').style.display = 'flex';
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø¬ÙˆÙ‡ Ø§Ù„Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø­Ù…Ø±
        function updateModalPrice(price) {
            document.getElementById('modal-price-display').innerText = price;
        }

        // Close product modal
        function closeModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (ØªØ­Øª Ø§Ù„Ù‡ÙŠØ±Ùˆ)
        function loadCategories() {
            const navContainer = document.getElementById('dynamicCategories');
            // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…ÙˆØ­Ø¯
            let savedCategories = JSON.parse(localStorage.getItem('karmashaCategories')) || ["ÙØ±Ø§ÙŠØ¯ ØªØ´ÙŠÙƒÙ†", "ØªØ´ÙŠÙƒÙ† Ø³ØªØ±Ø¨Ø³"];

            navContainer.innerHTML = "";
            savedCategories.forEach((cat, index) => {
                // Ø¬Ø¹Ù„ Ø£ÙˆÙ„ Ù‚Ø³Ù… Ù†Ø´Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                let activeClass = (index === 0) ? "active" : "";
                navContainer.innerHTML += `
                    <a href="javascript:void(0)" onclick="selectCategory(this, '${cat}')" class="nav-item ${activeClass}">
                        ${cat}
                    </a>
                `;
            });

            // ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„ Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
            if (savedCategories.length > 0) {
                renderProductsForCategory(savedCategories[0]);
            }
        }

        function loadProductsByCategory() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            let savedCategories = JSON.parse(localStorage.getItem('karmashaCategories')) || ["ÙØ±Ø§ÙŠØ¯ ØªØ´ÙŠÙƒÙ†", "ØªØ´ÙŠÙƒÙ† Ø³ØªØ±Ø¨Ø³"];
            let products = JSON.parse(localStorage.getItem('products')) || [];

            savedCategories.forEach((cat, index) => {
                const section = document.createElement('section');
                section.id = `section-${index}`;
                section.className = 'product-section';

                const title = document.createElement('h2');
                title.className = 'section-title';
                title.textContent = cat;
                section.appendChild(title);

                const grid = document.createElement('div');
                grid.className = 'products-grid';

                const categoryProducts = products.filter(product => product.category === cat);
                categoryProducts.forEach(product => {
                    const item = `<div class="food-card">
                        <div class="food-image">
                            <img src="fried-chicken.jpg" alt="${product.name}">
                        </div>
                        <div class="food-details">
                            <h3>${product.name}</h3>
                            <p>${product.description}</p>
                            <div class="options-group">
                                <label class="option">
                                    <input type="radio" name="${product.name.replace(/\s/g, '')}" checked>
                                    <span>Ø¹Ø§Ø¯ÙŠ <b>${product.price}Ø¬</b></span>
                                </label>
                            </div>
                            <button class="add-to-cart-btn" onclick="addToCart('${product.name}', ${product.price})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
                        </div>
                    </div>`;
                    grid.innerHTML += item;
                });

                section.appendChild(grid);
                container.appendChild(section);
            });
        }

        window.cart = [];
        window.total = 0;

        // Ø¯Ø§Ù„Ø© ÙØªØ­ ÙˆÙ‚ÙÙ„ Ø§Ù„Ø³Ù„Ø©
        window.toggleCart = function() {
            const cartSidebar = document.getElementById('cart-sidebar');
            if (cartSidebar) {
                cartSidebar.classList.toggle('open');
            } else {
                console.error("Ø¹Ù†ØµØ± Ø§Ù„Ø³Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©!");
            }
        };

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© (Ø§Ø³ØªØ¯Ø¹ÙŠÙ‡Ø§ Ù…Ù† Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ¬Ø¨Ø©)
        function addToCart(name, price) {
            window.cart.push({ name, price });
            updateCartUI();
            // ØªÙØªÙŠØ­ Ø§Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            document.getElementById('cart-sidebar').classList.add('open');
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');

            cartItems.innerHTML = "";
            window.total = 0;

            window.cart.forEach((item, index) => {
                window.total += item.price;
                cartItems.innerHTML += `
                    <div class="cart-item" style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding:5px;">
                        <span>${item.name}</span>
                        <b>${item.price} Ø¬</b>
                        <button onclick="removeFromCart(${index})" style="color:red; border:none; background:none; cursor:pointer;">Ø­Ø°Ù</button>
                    </div>
                `;
            });

            cartCount.innerText = window.cart.length;
            cartTotal.innerText = window.total;
        }
        window.updateCartUI = updateCartUI;

        function removeFromCart(index) {
            window.cart.splice(index, 1);
            updateCartUI();
        }



        // 1. ÙˆØ¸Ø§Ø¦Ù ÙØªØ­ ÙˆÙ‚ÙÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        function openAuthModal() { document.getElementById('auth-modal').style.display = 'block'; }
        function closeAuthModal() { document.getElementById('auth-modal').style.display = 'none'; }
        function toggleAuth(type) {
            document.getElementById('login-form').style.display = type === 'reg' ? 'none' : 'block';
            document.getElementById('register-form').style.display = type === 'reg' ? 'block' : 'none';
        }

        // 2. ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ (Ø­ÙØ¸ ÙÙŠ LocalStorage)
        function register() {
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const pass = document.getElementById('reg-pass').value;

            if (!name || !phone || !pass) return alert("ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ Ø¨Ø·Ù„!");

            let users = JSON.parse(localStorage.getItem('karmashaUsers')) || [];
            users.push({ name, phone, pass });
            localStorage.setItem('karmashaUsers', JSON.stringify(users));

            alert("Ù…Ø¨Ø±ÙˆÙƒ! Ø­Ø³Ø§Ø¨Ùƒ Ø¬Ø§Ù‡Ø²ØŒ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¯Ù„ÙˆÙ‚ØªÙŠ.");
            toggleAuth('login');
        }

        // 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        let currentUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;

        function login() {
            const phone = document.getElementById('login-phone').value;
            const pass = document.getElementById('login-pass').value;

            let users = JSON.parse(localStorage.getItem('karmashaUsers')) || [];
            const user = users.find(u => u.phone === phone && u.pass === pass);

            if (user) {
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                currentUser = user;
                updateUIForUser();
                closeAuthModal();
                alert("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù‚Ø±Ù…Ø´Ø© ÙŠØ§ " + user.name);
            } else {
                alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø·! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯.");
            }
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù…Ø§ ÙŠØ³Ø¬Ù„
        function updateUIForUser() {
            if (currentUser) {
                document.getElementById('user-area').innerHTML = `
                    <div class="user-profile-trigger" onclick="toggleProfileModal()">
                        <i class="fas fa-user-circle"></i>
                        <span id="display-user-name">Ø£Ù‡Ù„Ø§Ù‹ ${currentUser.name}</span>
                    </div>
                `;
            } else {
                document.getElementById('user-area').innerHTML = `
                    <button onclick="openAuthModal()" class="login-btn-nav shine-btn">
                        <i class="fas fa-user-circle"></i> Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„
                    </button>
                `;
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            location.reload();
        }

        // ÙˆØ¸ÙŠÙØ© ÙØªØ­ ÙˆÙ‚ÙÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
        window.toggleProfileModal = function() {
            const modal = document.getElementById('profile-modal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
                loadUserOrders(); // Ø­Ù…Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙØªØ­
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ²
        async function loadUserOrders() {
            const listContainer = document.getElementById('user-orders-list');
            const currentUser = JSON.parse(localStorage.getItem('loggedInUser'));

            // Ù„Ùˆ Ù…ÙÙŠØ´ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ Ø§Ø®Ø±Ø¬
            if (!currentUser || !currentUser.phone) {
                listContainer.innerHTML = "<p>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</p>";
                return;
            }

            try {
                const q = query(
                    collection(window.db, "orders"),
                    where("customerPhone", "==", currentUser.phone),
                    orderBy("createdAt", "desc")
                );

                const querySnapshot = await getDocs(q);
                listContainer.innerHTML = "";

                if (querySnapshot.empty) {
                    listContainer.innerHTML = "<p>Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ø·Ù„Ø¨Ø§Øª.. Ø§Ø·Ù„Ø¨ Ø¯Ù„ÙˆÙ‚ØªÙŠ!</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const order = doc.data();
                    listContainer.innerHTML += `
                        <div class="user-order-item">
                            <span>#${doc.id.substring(0,5)}</span>
                            <span class="order-status-badge">${order.status}</span>
                            <b>${order.totalPrice} Ø¬</b>
                        </div>
                    `;
                });
            } catch (e) {
                console.error("Error loading orders: ", e);
                listContainer.innerHTML = "<p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>";
            }
        }

        // 4. Ø´ØºÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­
        window.onload = function() {
            updateUIForUser();
            loadCategories();
            window.allProducts = JSON.parse(localStorage.getItem('products')) || [];
            window.logger = setup_logger();
        };

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        function listenToCategories() {
            const q = query(collection(window.db, "categories"), orderBy("createdAt", "asc"));

            onSnapshot(q, (snapshot) => {
                const navContainer = document.getElementById('dynamicCategories');
                navContainer.innerHTML = "";

                snapshot.forEach((doc) => {
                    const cat = doc.data().name;
                    navContainer.innerHTML += `
                        <a href="javascript:void(0)" onclick="renderProductsForCategory('${cat}')" class="nav-item">
                            ${cat}
                        </a>
                    `;
                });
            });
        }

        // ÙˆØ¸ÙŠÙØ© ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù€ ID Ù…Ø·Ø§Ø¨Ù‚)
        function openAuthModal() {
            console.log("Ø­Ø§ÙˆÙ„Øª Ø£ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„"); // Ø¹Ø´Ø§Ù† ØªØªØ£ÙƒØ¯ ÙÙŠ Ø§Ù„Ù€ Console Ø¥Ù†Ù‡Ø§ Ø´ØºØ§Ù„Ø©
            document.getElementById('auth-modal').style.display = 'block';
        }

        // ÙˆØ¸ÙŠÙØ© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        function closeAuthModal() {
            document.getElementById('auth-modal').style.display = 'none';
        }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø¯Ø®ÙˆÙ„ ÙˆØªØ³Ø¬ÙŠÙ„
        function toggleAuth(type) {
            if (type === 'reg') {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            } else {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ùˆ Ø¶ØºØ·Øª ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¨Ø±Ù‡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø¨ÙŠØ¶
        window.onclick = function(event) {
            let modal = document.getElementById('auth-modal');
            if (event.target == modal) {
                closeAuthModal();
            }
        }
    </script>

<script type="module">
        import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        window.allProducts = []; // Ù…Ø®Ø²Ù† Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª

        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ² (Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ)
        async function loadCategoriesFromFirebase() {
            const nav = document.getElementById('dynamicCategories');
            nav.innerHTML = '<span style="padding:10px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</span>';

            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ø±ØªØ¨Ø©
                const q = window.query(window.collection(window.db, "categories"), window.orderBy("createdAt", "asc"));
                const snapshot = await window.getDocs(q);

                nav.innerHTML = ''; // ØªÙØ±ÙŠØº
                let firstCat = null;

                if (snapshot.empty) {
                    nav.innerHTML = '<span>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù…</span>';
                    return;
                }

                snapshot.forEach((doc) => {
                    const catName = doc.data().name;
                    if(!firstCat) firstCat = catName; // Ø­ÙØ¸ Ø£ÙˆÙ„ Ù‚Ø³Ù… Ø¹Ø´Ø§Ù† Ù†ÙØ¹Ù„Ù‡

                    nav.innerHTML += `
                        <a href="javascript:void(0)"
                           onclick="selectCategory(this, '${catName}')"
                           class="nav-item ${firstCat === catName ? 'active' : ''}">
                           ${catName}
                        </a>`;
                });

                // Ø¨Ø¹Ø¯ Ù…Ø§ Ø­Ù…Ù„Ù†Ø§ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…ØŒ Ù†Ø­Ù…Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆÙ†Ø¹Ø±Ø¶ Ø£ÙˆÙ„ Ù‚Ø³Ù…
                await loadProductsFromFirebase(firstCat);

            } catch (e) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:", e);
                nav.innerHTML = '<span>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</span>';
            }
        }

        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        async function loadProductsFromFirebase(defaultCat) {
            try {
                const snapshot = await window.getDocs(window.collection(window.db, "products"));
                window.allProducts = [];
                snapshot.forEach(doc => {
                    window.allProducts.push(doc.data());
                });

                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                if(defaultCat) {
                    renderProductsForCategory(defaultCat);
                }
            } catch(e) { console.error(e); }
        }

        // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù…Ø¹ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø¹Ø±)
        window.renderProductsForCategory = function(catName) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            // ØªØµÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
            const filtered = window.allProducts.filter(p => p.category === catName);

            if (filtered.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding:50px; width:100%;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‚Ø³Ù… ${catName} Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'products-grid';

            filtered.forEach(p => {
                // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø¹Ø± (Ù„Ùˆ Ù…ÙÙŠØ´ Ø£Ø³Ø¹Ø§Ø± Ø­Ø· "Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨")
                let displayPrice = "Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨";
                if (p.prices && p.prices.length > 0) {
                    displayPrice = p.prices[0].price + " Ø¬";
                }

                const pStr = encodeURIComponent(JSON.stringify(p));
                
                grid.innerHTML += `
                    <div class="food-card" onclick="openModal('${pStr}')">
                        <div class="food-image">
                            <img src="${p.img || 'https://via.placeholder.com/150'}" onerror="this.src='https://via.placeholder.com/150'">
                        </div>
                        <div class="food-details">
                            <h3>${p.name}</h3>
                            <span class="price-tag">${displayPrice}</span>
                            <button class="view-btn">Ø§Ø·Ù„Ø¨</button>
                        </div>
                    </div>`;
            });
            container.appendChild(grid);
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù (ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ØŒ Ø¥Ù„Ø®)
        window.selectCategory = function(el, catName) {
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            renderProductsForCategory(catName);
        }

        window.openModal = function(str) {
            const p = JSON.parse(decodeURIComponent(str));
            document.getElementById('modal-name').innerText = p.name;
            document.getElementById('modal-desc').innerText = p.description;
            document.getElementById('modal-img').src = p.img || '';
            
            const opts = document.getElementById('price-options-container');
            opts.innerHTML = '';

            if(p.prices && p.prices.length > 0) {
                p.prices.forEach((pr, i) => {
                    opts.innerHTML += `
                        <label class="size-option">
                            <input type="radio" name="size" value="${pr.price}" data-name="${pr.size}" ${i===0?'checked':''} 
                            onchange="document.getElementById('modal-price-display').innerText=this.value"> 
                            ${pr.size} (${pr.price} Ø¬)
                        </label>`;
                });
                document.getElementById('modal-price-display').innerText = p.prices[0].price;
            } else {
                opts.innerHTML = '<p>Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯</p>';
                document.getElementById('modal-price-display').innerText = '0';
            }

            document.getElementById('modal-add-btn').onclick = () => {
                const sel = document.querySelector('input[name="size"]:checked');
                if(sel) {
                    addToCart(`${p.name} (${sel.dataset.name})`, parseInt(sel.value));
                    document.getElementById('product-modal').style.display = 'none';
                } else {
                    alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹");
                }
            };
            document.getElementById('product-modal').style.display = 'flex';
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
            loadCategoriesFromFirebase(); // Ø¯ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù„ÙŠ Ù‡ØªØ¸Ø¨Ø· Ø§Ù„Ø¯Ù†ÙŠØ§
        }
        
        // (Ø¨Ù‚ÙŠØª Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„Ø´Ø§Øª Ø³ÙŠØ¨Ù‡Ø§ Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ Ø£Ùˆ Ø§Ù†Ø³Ø®Ù‡Ø§ Ù…Ù† Ø§Ù„Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ùˆ Ù†Ø§Ù‚ØµØ©)
        // ... (Cart, Auth, Chat functions here) ...
         // Cart
        window.cart = []; window.total = 0;
        window.toggleCart = function() { document.getElementById('cart-sidebar').classList.toggle('open'); }
        window.addToCart = function(name, price) { window.cart.push({name,price}); updateCartUI(); toggleCart(); }
        window.updateCartUI = () => {
            const div = document.getElementById('cart-items'); div.innerHTML=''; window.total=0;
            window.cart.forEach((i,x)=>{ window.total+=i.price; div.innerHTML+=`<div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>${i.name}</span><span>${i.price} <span style="color:red;cursor:pointer" onclick="window.cart.splice(${x},1);updateCartUI()">x</span></span></div>`; });
            document.getElementById('cart-total').innerText = window.total; document.getElementById('cart-count').innerText=window.cart.length;
        }
        
        // Auth Helpers
        window.openAuthModal = () => document.getElementById('auth-modal').style.display='flex';
        window.closeAuthModal = () => document.getElementById('auth-modal').style.display='none';
        window.toggleAuth = (t) => {
            document.getElementById('login-form').style.display = t=='reg'?'none':'block';
            document.getElementById('register-form').style.display = t=='reg'?'block':'none';
        }
        // Auth & Chat Logic (Ù†ÙØ³ Ø§Ù„Ù„ÙŠ ÙØ§Øª)
        window.registerUser = async function() {
            const phone = document.getElementById('reg-email').value;
            const email = phone + "@karmasha.com";
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;
            try {
                const cred = await window.createUserWithEmailAndPassword(window.auth, email, pass);
                await window.setDoc(window.doc(window.db, "users", cred.user.uid), { name: name, phone: phone });
                alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!"); closeAuthModal();
            } catch(e) { alert("Ø®Ø·Ø£: " + e.message); }
        }

        window.loginUser = async function() {
            const phone = document.getElementById('login-email').value;
            const email = phone.includes('@') ? phone : phone + "@karmasha.com";
            const pass = document.getElementById('login-pass').value;
            try {
                await window.signInWithEmailAndPassword(window.auth, email, pass);
                closeAuthModal();
            } catch(e) { alert("Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙ„Ø·"); }
        }

        window.logoutUser = () => window.signOut(window.auth);

        window.onAuthStateChanged(window.auth, (user) => {
            window.currentUser = user;
            if(user) {
                document.getElementById('user-area').innerHTML = `<span style="color:white; font-size:14px; font-weight:bold">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ <br><small onclick="window.logoutUser()" style="cursor:pointer; text-decoration:underline;">Ø®Ø±ÙˆØ¬</small></span>`;
                // Auto fill checkout
                document.getElementById('cust-phone').value = user.email.replace("@karmasha.com", "");
            } else {
                document.getElementById('user-area').innerHTML = `<button onclick="openAuthModal()" class="login-btn-nav">Ø¯Ø®ÙˆÙ„</button>`;
            }
        }); // Ù‚ÙÙ„Ø© Ø§Ù„Ù€ onAuthStateChanged

        // Ø¯Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ - ØªÙˆØ¶Ø¹ Ù‡Ù†Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
        document.getElementById('confirmOrderBtn').onclick = async () => {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø³Ù„Ø© Ù…Ø´ ÙØ§Ø¶ÙŠØ©
            if (!window.cart || window.cart.length === 0) {
                return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©! Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ø© Ø­Ù„ÙˆØ© Ø§Ù„Ø£ÙˆÙ„ ğŸ—");
            }

            // Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            const n = document.getElementById('cust-name').value;
            const p = document.getElementById('cust-phone').value;
            const a = document.getElementById('cust-address').value;

            // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©
            if (!n || !p || !a) {
                return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©.. ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ø´Ø§Ù† Ù†Ø¬ÙŠÙ„Ùƒ Ø¨Ø³Ø±Ø¹Ø©!");
            }

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ²
                await addDoc(collection(db, "orders"), {
                    customerName: n,
                    customerPhone: p,
                    customerAddress: a,
                    items: window.cart,
                    totalPrice: window.total,
                    status: "Ø¬Ø¯ÙŠØ¯",
                    createdAt: serverTimestamp()
                });
                
                alert("ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø·Ù„Ø¨Ùƒ Ø¨ÙŠØªØ­Ø¶Ø± Ø¯Ù„ÙˆÙ‚ØªÙŠ ğŸŸ");
                window.cart = [];
                updateCartUI();
                toggleCart();
            } catch (e) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ", e);
                alert("Ø¹ÙÙˆØ§Ù‹ Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø©.. Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ");
            }
        };

    </script> <!-- Ù‚ÙÙ„Ø© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->

    <!-- Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div id="cart-sidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3>Ø·Ù„Ø¨Ø§ØªÙƒ ğŸŸ</h3>
            <button onclick="toggleCart()" class="close-btn">&times;</button>
        </div>
        <div id="cart-items" class="cart-items">
            <p class="empty-msg">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.. Ø§Ø·Ù„Ø¨ Ø¯Ù„ÙˆÙ‚ØªÙŠ!</p>
        </div>
        <div class="cart-footer">
            <div class="total-price">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cart-total">0</span> Ø¬.Ù…</div>
            <div class="checkout-form">
                <h4>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                <input type="text" id="cust-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
                <input type="tel" id="cust-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
                <textarea id="cust-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></textarea>
                <button id="confirmOrderBtn" class="order-submit-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© (ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ Ù…ÙƒØªÙˆØ¨Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù‡Ù†Ø§) -->
    <div class="cart-toggle ripple" onclick="toggleCart()">
        <i class="fas fa-shopping-basket"></i>
        <span id="cart-count">0</span>
    </div>

    <!-- ÙÙˆØªØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø´ÙŠÙƒ ÙˆØ¨Ø³ÙŠØ· -->
    <footer style="background: #111; color: white; text-align: center; padding: 25px; margin-top: 50px; border-top: 3px solid #e31e24;">
        <p style="margin: 0; font-family: 'Cairo', sans-serif;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù…Ø·Ø¹Ù… Ù‚Ø±Ù…Ø´Ø© Â© 2024</p>
    </footer>

</body>
</html>
